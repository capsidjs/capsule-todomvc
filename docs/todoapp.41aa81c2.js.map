{"version":3,"sources":["node_modules/@kt3k/capsule/esm/util.js","node_modules/@kt3k/capsule/esm/mod.js","src/todo-models.ts","src/todoapp.ts"],"names":["READY_STATE_CHANGE","p","documentReady","Promise","resolve","doc","document","checkReady","readyState","removeEventListener","addEventListener","boldColor","color","defaultEventColor","logEvent","component","e","module","__DEV__","event","type","console","groupCollapsed","log","target","groupEnd","registry","assert","assertion","message","Error","assertComponentNameIsValid","name","initClass","hooks","el","classList","add","remove","once","mountHooks","initializer","contains","ctx","createEventContext","CustomEvent","bubbles","map","cb","sel","then","mount","on","Proxy","set","_","value","addEventBindHook","get","outside","push","listener","apply","_target","_thisArg","args","selector","is","sub","innerHTML","html","query","s","querySelector","queryAll","querySelectorAll","pub","data","forEach","dispatchEvent","detail","emit","handler","some","call","node","classNames","Object","keys","className","unmount"],"mappings":"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","file":"todoapp.41aa81c2.js","sourceRoot":"..","sourcesContent":["// Copyright 2022 Yoshiya Hinosawa. All rights reserved. MIT license.\nconst READY_STATE_CHANGE = \"readystatechange\";\nlet p;\nexport function documentReady() {\n    return p = p || new Promise((resolve) => {\n        const doc = document;\n        const checkReady = () => {\n            if (doc.readyState === \"complete\") {\n                resolve();\n                doc.removeEventListener(READY_STATE_CHANGE, checkReady);\n            }\n        };\n        doc.addEventListener(READY_STATE_CHANGE, checkReady);\n        checkReady();\n    });\n}\n/** Gets the bold colored style */\nconst boldColor = (color) => `color: ${color}; font-weight: bold;`;\nconst defaultEventColor = \"#f012be\";\nexport function logEvent({ component, e, module, color, }) {\n    if (typeof __DEV__ === \"boolean\" && !__DEV__)\n        return;\n    const event = e.type;\n    console.groupCollapsed(`${module}> %c${event}%c on %c${component}`, boldColor(color || defaultEventColor), \"\", boldColor(\"#1a80cc\"));\n    console.log(e);\n    if (e.target) {\n        console.log(e.target);\n    }\n    console.groupEnd();\n}\n","/*! Capsule v0.5.1 | Copyright 2022 Yoshiya Hinosawa and Capsule contributors | MIT license */\nimport { documentReady, logEvent } from \"./util.js\";\n/** The registry of component initializers. */\nconst registry = {};\n/**\n * Asserts the given condition holds, otherwise throws.\n * @param assertion The assertion expression\n * @param message The assertion message\n */\nfunction assert(assertion, message) {\n    if (!assertion) {\n        throw new Error(message);\n    }\n}\n/** Asserts the given name is a valid component name.\n * @param name The component name */\nfunction assertComponentNameIsValid(name) {\n    assert(typeof name === \"string\", \"The name should be a string\");\n    assert(!!registry[name], `The component of the given name is not registered: ${name}`);\n}\nexport function component(name) {\n    assert(typeof name === \"string\" && !!name, \"Component name must be a non-empty string\");\n    assert(!registry[name], `The component of the given name is already registered: ${name}`);\n    const initClass = `${name}-ðŸ’Š`;\n    // Hooks for mount phase\n    const hooks = [({ el }) => {\n            // FIXME(kt3k): the below can be written as .add(name, initClass)\n            // when deno_dom fixes add class.\n            el.classList.add(name);\n            el.classList.add(initClass);\n            el.addEventListener(`__ummount__:${name}`, () => {\n                el.classList.remove(initClass);\n            }, { once: true });\n        }];\n    const mountHooks = [];\n    /** Initializes the html element by the given configuration. */\n    const initializer = (el) => {\n        if (!el.classList.contains(initClass)) {\n            const e = new CustomEvent(\"__mount__\", { bubbles: false });\n            const ctx = createEventContext(e, el);\n            // Initialize `before mount` hooks\n            // This includes:\n            // - initialization of event handlers\n            // - initialization of innerHTML\n            // - initialization of class names (is, sub)\n            hooks.map((cb) => {\n                cb(ctx);\n            });\n            // Execute __mount__ hooks\n            mountHooks.map((cb) => {\n                cb(ctx);\n            });\n        }\n    };\n    // The selector\n    initializer.sel = `.${name}:not(.${initClass})`;\n    registry[name] = initializer;\n    documentReady().then(() => {\n        mount(name);\n    });\n    // deno-lint-ignore no-explicit-any\n    const on = new Proxy(() => { }, {\n        set(_, type, value) {\n            // deno-lint-ignore no-explicit-any\n            return addEventBindHook(name, hooks, mountHooks, type, value);\n        },\n        get(_, outside) {\n            if (outside === \"outside\") {\n                return new Proxy({}, {\n                    set(_, type, value) {\n                        assert(typeof value === \"function\", `Event handler must be a function, ${typeof value} (${value}) is given`);\n                        hooks.push(({ el }) => {\n                            const listener = (e) => {\n                                // deno-lint-ignore no-explicit-any\n                                if (el !== e.target && !el.contains(e.target)) {\n                                    logEvent({\n                                        module: \"outside\",\n                                        color: \"#39cccc\",\n                                        e,\n                                        component: name,\n                                    });\n                                    value(createEventContext(e, el));\n                                }\n                            };\n                            document.addEventListener(type, listener);\n                            el.addEventListener(`__unmount__:${name}`, () => {\n                                document.removeEventListener(type, listener);\n                            }, { once: true });\n                        });\n                        return true;\n                    },\n                });\n            }\n            return null;\n        },\n        apply(_target, _thisArg, args) {\n            const selector = args[0];\n            assert(typeof selector === \"string\", \"Delegation selector must be a string. ${typeof selector} is given.\");\n            return new Proxy({}, {\n                set(_, type, value) {\n                    return addEventBindHook(name, hooks, mountHooks, type, \n                    // deno-lint-ignore no-explicit-any\n                    value, selector);\n                },\n            });\n        },\n    });\n    const is = (name) => {\n        hooks.push(({ el }) => {\n            el.classList.add(name);\n        });\n    };\n    const sub = (type) => is(`sub:${type}`);\n    const innerHTML = (html) => {\n        hooks.push(({ el }) => {\n            el.innerHTML = html;\n        });\n    };\n    return { on, is, sub, innerHTML };\n}\nfunction createEventContext(e, el) {\n    return {\n        e,\n        el,\n        query: (s) => el.querySelector(s),\n        queryAll: (s) => el.querySelectorAll(s),\n        pub: (type, data) => {\n            document.querySelectorAll(`.sub\\\\:${type}`).forEach((el) => {\n                el.dispatchEvent(new CustomEvent(type, { bubbles: false, detail: data }));\n            });\n        },\n        emit: (type, data) => {\n            el.dispatchEvent(new CustomEvent(type, { bubbles: true, detail: data }));\n        },\n    };\n}\nfunction addEventBindHook(name, hooks, mountHooks, type, handler, selector) {\n    assert(typeof handler === \"function\", `Event handler must be a function, ${typeof handler} (${handler}) is given`);\n    if (type === \"__mount__\") {\n        mountHooks.push(handler);\n        return true;\n    }\n    if (type === \"__unmount__\") {\n        hooks.push(({ el }) => {\n            el.addEventListener(`__unmount__:${name}`, () => {\n                handler(createEventContext(new CustomEvent(\"__unmount__\"), el));\n            }, { once: true });\n        });\n        return true;\n    }\n    hooks.push(({ el }) => {\n        const listener = (e) => {\n            if (!selector ||\n                [].some.call(el.querySelectorAll(selector), (node) => node === e.target || node.contains(e.target))) {\n                logEvent({\n                    module: \"ðŸ’Š\",\n                    color: \"#e0407b\",\n                    e,\n                    component: name,\n                });\n                handler(createEventContext(e, el));\n            }\n        };\n        el.addEventListener(`__unmount__:${name}`, () => {\n            el.removeEventListener(type, listener);\n        }, { once: true });\n        el.addEventListener(type, listener);\n    });\n    return true;\n}\nexport function mount(name, el) {\n    let classNames;\n    if (!name) {\n        classNames = Object.keys(registry);\n    }\n    else {\n        assertComponentNameIsValid(name);\n        classNames = [name];\n    }\n    classNames.map((className) => {\n        [].map.call((el || document).querySelectorAll(registry[className].sel), registry[className]);\n    });\n}\nexport function unmount(name, el) {\n    assert(!!registry[name], `The component of the given name is not registered: ${name}`);\n    el.dispatchEvent(new CustomEvent(`__unmount__:${name}`));\n}\n","/** Todo represents a single Todo item. */\nexport class Todo {\n  constructor(\n    public id: string,\n    public title: string,\n    public completed: boolean,\n  ) {}\n\n  toggle() {\n    this.completed = !this.completed;\n  }\n}\n\nconst KEY = \"capsule-todomvc\";\n\n/** TodoCollection represents a collection of Todos. */\nexport class TodoCollection {\n  constructor(public todos: Todo[] = []) {}\n\n  getById(id: string): Todo | null {\n    return this.todos.find((todo) => todo.id === id);\n  }\n\n  remove(toRemove: Todo): void {\n    this.todos = this.todos.filter((todo) => todo.id !== toRemove.id);\n  }\n\n  add(todo: Todo): void {\n    this.todos.push(todo);\n  }\n\n  get length(): number {\n    return this.todos.length;\n  }\n\n  has(test: Todo): boolean {\n    return this.todos.some((todo) => todo.id === test.id);\n  }\n\n  completed(): TodoCollection {\n    return new TodoCollection(this.todos.filter((todo) => todo.completed));\n  }\n\n  uncompleted(): TodoCollection {\n    return new TodoCollection(this.todos.filter((todo) => !todo.completed));\n  }\n\n  completeAll(): void {\n    this.todos.forEach((todo) => {\n      todo.completed = true;\n    });\n  }\n\n  uncompleteAll(): void {\n    this.todos.forEach((todo) => {\n      todo.completed = false;\n    });\n  }\n\n  forEach(f: (todo: Todo) => void): void {\n    this.todos.forEach(f);\n  }\n\n  toJSON(): string {\n    return JSON.stringify(this.todos);\n  }\n\n  static fromJson(json: string) {\n    return new TodoCollection(\n      JSON.parse(json).map(\n        ({ id, title, completed }) => new Todo(id, title, completed),\n      ),\n    );\n  }\n\n  save() {\n    localStorage.setItem(KEY, this.toJSON());\n  }\n\n  static restore(): TodoCollection {\n    return TodoCollection.fromJson(localStorage.getItem(KEY) || \"[]\");\n  }\n\n  maxId() {\n    return Math.max(0, ...this.todos.map((todo) => +todo.id));\n  }\n}\n","import { component } from \"@kt3k/capsule\";\nimport { Todo, TodoCollection } from \"./todo-models\";\n\ntype Filter = \"all\" | \"completed\" | \"uncompleted\";\n\nlet id = 0;\n/** The current filter */\nlet filter: Filter = \"all\";\n/** The current todo, including completed and uncompleted */\nlet todos: TodoCollection;\n\nconst { on } = component(\"todoapp\");\n\non.__mount__ = ({ query, emit }) => {\n  todos = TodoCollection.restore();\n  id = todos.maxId() + 1;\n\n  window.onhashchange = () => {\n    onChangeFilter({ emit, query });\n  };\n  onChangeFilter({ emit, query });\n  query<HTMLInputElement>(\".new-todo\").focus();\n  emit(\"update-todo\");\n};\n\non(\".new-todo\").keypress = ({ e, query, emit }) => {\n  if ((e as any).which !== 13) {\n    // If not a Enter, ignore the event\n    return;\n  }\n  const newInput = query<HTMLInputElement>(\".new-todo\")!;\n  const title = query<HTMLInputElement>(\".new-todo\")?.value?.trim();\n  if (!title) {\n    return;\n  }\n\n  newInput.value = \"\";\n  todos.add(new Todo(`${id++}`, title, false));\n  emit(\"update-todo\");\n};\n\non(\".toggle\").click = ({ e, emit }) => {\n  todos.getById((e.target as Element).parentElement.parentElement.id)?.toggle();\n  emit(\"update-todo\");\n};\n\non(\".toggle-all\").click = ({ e, emit }) => {\n  if ((e.target as any).checked) {\n    todos.completeAll();\n  } else {\n    todos.uncompleteAll();\n  }\n  emit(\"update-todo\");\n};\n\non(\".destroy\").click = ({ e, emit }) => {\n  const toRemove = todos.getById(\n    (e.target as Element).parentElement.parentElement.id,\n  );\n  todos.remove(toRemove);\n  emit(\"update-todo\");\n};\n\non(\".clear-completed\").click = ({ emit }) => {\n  todos.completed().forEach((todo) => {\n    todos.remove(todo);\n  });\n  emit(\"update-todo\");\n};\n\non(\".todo > .view > label\").dblclick = ({ e }) => {\n  const todoItem = (e.target as Element).parentElement.parentElement;\n  const todo = todos.getById(todoItem.id);\n  todoItem.classList.add(\"editing\");\n  const editInput = todoItem.querySelector<HTMLInputElement>(\".edit\");\n  editInput.value = todo.title;\n  editInput.focus();\n};\n\non(\".edit\").keypress = on(\".edit\").keydown = ({ e }) => {\n  const input: HTMLInputElement = e.target as any;\n  if ((e as any).which === 13 /* ENTER */) {\n    input.blur();\n  } else if ((e as any).which === 27 /* ESC */) {\n    input.value = todos.getById(input.parentElement.id).title;\n    input.blur();\n  }\n};\n\non(\".edit\").focusout = ({ e, emit }) => {\n  const input = e.target as HTMLInputElement;\n  const value = input.value.trim();\n  const todoItem = input.parentElement;\n  if (value) {\n    todos.getById(todoItem.id).title = value;\n    todoItem.classList.remove(\"editing\");\n  } else {\n    todos.remove(todos.getById(todoItem.id));\n    todoItem.classList.remove(\"editing\");\n  }\n  emit(\"update-todo\");\n};\n\nfunction onChangeFilter({ emit, query }) {\n  const { hash } = location;\n  if (hash === \"#/active\") {\n    filter = \"uncompleted\";\n  } else if (hash === \"#/completed\") {\n    filter = \"completed\";\n  } else {\n    filter = \"all\";\n  }\n  query('a[href=\"#/all\"]')!.classList.toggle(\"selected\", filter === \"all\");\n  query('a[href=\"#/active\"]')!.classList.toggle(\n    \"selected\",\n    filter === \"uncompleted\",\n  );\n  query('a[href=\"#/completed\"]')!.classList.toggle(\n    \"selected\",\n    filter === \"completed\",\n  );\n  emit(\"update-todo\");\n}\n\non[\"update-todo\"] = ({ query }) => {\n  todos.save();\n  const uncompleted = todos.uncompleted();\n  const completed = todos.completed();\n  const todoList = query(\".todo-list\")!;\n  query(\".todo-count strong\").textContent = `${uncompleted.length}`;\n  query(\".todo-count .plural\").classList.toggle(\n    \"hidden\",\n    uncompleted.length === 1,\n  );\n  query(\".main\").classList.toggle(\"hidden\", todos.length === 0);\n  query(\".footer\").classList.toggle(\"hidden\", todos.length === 0);\n  query(\".toggle-all\").classList.toggle(\"hidden\", todos.length === 0);\n  query('label[for=\"toggle-all\"]').classList.toggle(\n    \"hidden\",\n    todos.length === 0,\n  );\n  query<HTMLInputElement>(\".toggle-all\").checked = uncompleted.length === 0;\n  query(\".clear-completed\").classList.toggle(\"hidden\", completed.length === 0);\n  if (\n    filter === \"all\" &&\n    todos.length === todoList.children.length\n  ) {\n    // Doesn't replace the list items.\n    todos.forEach((todo) => {\n      const li = todoList.querySelector(`[id=\"${todo.id}\"]`);\n      li.classList.toggle(\"completed\", todo.completed);\n      li.querySelector(\"label\").textContent = todo.title;\n      li.querySelector<HTMLInputElement>(\".toggle\").checked = todo.completed;\n    });\n  } else {\n    // TODO(kt3k): This replace the entire list items.\n    // The performance can be improved by reusing reusable list items.\n    const visibleItems = filter === \"uncompleted\"\n      ? uncompleted\n      : filter === \"completed\"\n      ? completed\n      : todos;\n    todoList.innerHTML = \"\";\n    visibleItems.forEach((todo) => {\n      const li = document.createElement(\"li\");\n      li.innerHTML = `\n        <div class=\"view\">\n          <input class=\"toggle\" type=\"checkbox\" ${\n        todo.completed ? \"checked\" : \"\"\n      }/>\n          <label>${todo.title}</label>\n          <button class=\"destroy\"></button>\n        </div>\n        <input class=\"edit\" type=\"text\" />\n      `;\n      li.id = todo.id;\n      li.classList.add(\"todo\");\n      li.classList.toggle(\"completed\", todo.completed);\n      todoList.appendChild(li);\n    });\n  }\n};\n"]}